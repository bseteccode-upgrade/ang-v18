<section class="start_wrapper issue-certificate-list separate_pages">
  <!-- <div id="google_translate_element"></div> -->
  <div class="panel-heading clearfix row">
    <div class="header-block">
      <div class="container">
        <div class="col-md-12 col-sm-12">
          <div class="col-md-4 col-sm-12">
            <div class="header-logo">
              <img [src]="domSanitizer.bypassSecurityTrustUrl(logo_url)" class="img-responsive">
            </div>
          </div>

          <div class="col-md-3 col-sm-12">
          </div>

          <div class="col-md-5 col-sm-12">
            <div class="back_btn">
              <div class="lang_main">
                <button [style.background-color]="reportPageContent.search_bottun_color" mat-button [matMenuTriggerFor]="menulang" class="dropdown_select">
                  {{selectedLang}}
                  <span class="caret"></span>
                </button>
                <div class="theme-palette">
                  <div class="lang">
                    <mat-menu #menulang="matMenu">
                      <button mat-menu-item class="lang_submenu" *ngFor="let lang of languages"
                        (click)="selectLang(lang)">
                        {{lang.language_code}}</button>
                    </mat-menu>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="hpanel_main">
    <div class="hpanel">
      <!-- <div class="panel-heading clearfix">
      <div class="pull-left">
        <h3>{{'track_activity_details' | translate}}</h3>
      </div>
    </div> -->

      <div class="col-sm-12" *ngIf="!compinecode">

        <div class="panel-heading clearfix filter-search-box">
          <div class="container">
            <div [innerHtml]="convertStyle(reportPageContent.report_top_content)"></div>
            <fieldset class="scheduler-border">
              <form [formGroup]="searchForm" (ngSubmit)="searchFormSubmit(searchForm.value)">
                <div class="col-md-10 col-sm-12">
                  <mat-form-field >
                    <mat-label>{{'search' | translate}}</mat-label>
                    <input #searchVal formControlName="search" matInput class="form-control">
                    <div class="text-danger text-left small" *ngIf="errorMsg">{{getErrorMessage('search') | translate}}
                    </div>
                  </mat-form-field>
                </div>

                <div class="col-md-2 col-sm-12">
                  <div class="user-btn-block">
                    <button type="submit" class="filter-btn search" [style.background-color]="reportPageContent.search_bottun_color"
                      style="width:100%;" mat-mdc-button>{{'search' | translate}}</button>
                  </div>
                </div>
              </form>
            </fieldset>
            <div [innerHtml]="convertStyle(reportPageContent.report_bottom_content)"></div>
          </div>
        </div>

      </div>

      <div class="example-container" *ngIf="isLoadingResults">
        <div>
          <mat-spinner></mat-spinner>
        </div>
      </div>

      <div class="col-sm-12" *ngIf="!isLoadingResults && !resultfound && !initial">
        <div class="alert alert-info no-records">
          {{'no_records_found' | translate}}
        </div>
      </div>

      <div class="col-md-12" *ngIf="!isLoadingResults && resultfound">
        <div class="product_details">
          <div class="">
            <h2 class="text-capitalize">{{actDetail.title }}</h2>
          </div>
          <div *ngIf="waypointsData.length > 0" class="prime-boxes">
            <div class="product_info">
              <h4 style="color: #000;">{{'product_monitor' | translate}}</h4>
            </div>
            <div class="row product_detail_sections mid">
              <div class="panel-heading clearfix">
                <div class="product_details">
                  <div class="row row-eq-height">
                    <div class="col-md-12 col-sm-12 product-fourth-block sub-section">
                      <div class="sub-block">
                        <div class="row no-margin map-makers">
                          <div>
                            <div class="form-group mapDropdown">
                              <select class="form-control" (change)="selectedMap($event.target.value)">
                                <option [value]="null" [disabled]="true">{{'select_map_type' | translate}}</option>
                                <option [value]="1">{{'road_map' | translate}}</option>
                                <option [value]="2" [selected]="true">{{'marker' | translate}}</option>
                              </select>
                            </div>
                          </div>
                          <agm-map *ngIf="mapType == 2" [(latitude)]="lat" [(longitude)]="lng" [fitBounds]="true">
                            <agm-marker *ngFor="let data of waypointsData" [latitude]="data.location.lat"
                              [longitude]="data.location.lng" [label]="data.label" [agmFitBounds]="true">
                            </agm-marker>
                          </agm-map>

                          <agm-map *ngIf="mapType == 1" [latitude]="lat" [longitude]="lng">
                            <agm-direction [origin]="origin" [destination]="destination" [renderOptions]="renderOptions"
                              [markerOptions]="markerOptions" [waypoints]="waypointsRoadData"></agm-direction>
                          </agm-map>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="smart-pix">
            <div class="product_detail_sections">
              <ul class="product_detail_list">
                <li>{{'barcode' | translate}} - {{'batchid_display' | translate}}: </li>
                <li><span>{{actDetail.barcode}} - {{actDetail.batch_id}}</span></li>
              </ul>
            </div>
            <div class="smart-pixer" *ngIf="waypointsData.length > 0">
              <div class="product_detail_sections">
                <ul class="activity-head-details">
                  <li *ngIf="actDetail.image">
                    <img [src]="(actDetail.image)? actDetail.image : 'assets/images/university-logo.png'"
                      class="img-responsive product-logo-image">
                  </li>
                  <!-- <li *ngIf="actDetail.qr_code && actDetail.qr_code != 'None'">
                    <img [src]="(actDetail.qr_code !== 'None')? actDetail.qr_code : 'assets/images/certificates/qr.png'"
                      class="img-responsive">
                  </li> -->
                </ul>
              </div>
            </div>
            <div class="flexy-more" *ngIf="waypointsData.length === 0">
              <div class="product_detail_sections mid">
                <ul class="activity-head-details">
                  <li *ngIf="actDetail.image">
                    <img [src]="(actDetail.image)? actDetail.image : 'assets/images/university-logo.png'"
                      class="img-responsive product-logo-image">
                  </li>
                  <!-- <li *ngIf="actDetail.qr_code && actDetail.qr_code != 'None'">
                  <img [src]="(actDetail.qr_code !== 'None')? actDetail.qr_code : 'assets/images/certificates/qr.png'"
                    class="img-responsive">
                </li> -->
                </ul>
              </div>
            </div>

            <div *ngIf="waypointsData.length > 0" class="promo-one">
              <div class="product_detail_block" *ngIf="actDetail.description">
                <div class="prec-one">
                  <div class="product_info">
                    <!-- <h4 style="color: #000;">{{'description' | translate}}</h4> -->
                    <p [innerHtml]="convertStyle(actDetail.description)"></p>
                  </div>
                  <div>
                    <ul class="activity-head-details product_images_view" *ngFor="let certi of actDetail.certificates">
                      <ng-container *ngFor="let image of certi.description_image_lists">
                        <li *ngIf="image">
                          <img [src]="image" class="img-responsive">
                        </li>
                      </ng-container>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            <div *ngIf="waypointsData.length === 0" [className]="actDetail.description !== '' ? 'way-one' : 'way-one'">
              <div class="product_detail_block" *ngIf="actDetail.description">
                <div class="prime-score">
                  <div class="product_info">
                    <!-- <h4 style="color: #000;">{{'description' | translate}}</h4> -->
                    <p [innerHtml]="convertStyle(actDetail.description)"></p>
                  </div>
                  <div>
                    <ul class="activity-head-details product_images_view" *ngFor="let certi of actDetail.certificates">
                      <ng-container *ngFor="let image of certi.description_image_lists">
                        <li *ngIf="image">
                          <img [src]="image" class="img-responsive">
                        </li>
                      </ng-container>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div *ngIf="waypointsData.length > 0" class="prime-boxes-mobile-view">
            <div class="product_info">
              <h4 style="color: #000;">{{'product_monitor' | translate}}</h4>
            </div>
            <div class="row product_detail_sections mid">
              <div class="panel-heading clearfix">
                <div class="product_details">
                  <div class="row row-eq-height">
                    <div class="col-md-12 col-sm-12 product-fourth-block sub-section">
                      <div class="sub-block">
                        <div class="row no-margin map-makers">
                          <div>
                            <div class="form-group mapDropdown">
                              <select class="form-control" (change)="selectedMap($event.target.value)">
                                <option [value]="null" [disabled]="true">{{'select_map_type' | translate}}</option>
                                <option [value]="1" [selected]="true">{{'road_map' | translate}}</option>
                                <option [value]="2">{{'marker' | translate}}</option>
                              </select>
                            </div>
                          </div>
                          <agm-map *ngIf="mapType == 2" [(latitude)]="lat" [(longitude)]="lng" [fitBounds]="true">
                            <agm-marker *ngFor="let data of waypointsData" [latitude]="data.location.lat"
                              [longitude]="data.location.lng" [label]="data.label" [agmFitBounds]="true">
                            </agm-marker>
                          </agm-map>

                          <agm-map *ngIf="mapType == 1" [latitude]="lat" [longitude]="lng">
                            <agm-direction [origin]="origin" [destination]="destination" [renderOptions]="renderOptions"
                              [markerOptions]="markerOptions" [waypoints]="waypointsRoadData"></agm-direction>
                          </agm-map>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="activity_field" *ngIf="dataSubProductLists.length > 0">
          <div class="col-sm-12">
            <div class="form-group">
              <label class="control-label" for="product">{{'activity' | translate}}</label>
              <select class="form-control" #productRef (change)="getBatchActivityDetyails(productRef.value)">
                <option [value]="null" [disabled]="true">{{'select' | translate}} {{'activity' | translate}}</option>
                <option value={{batchId}} [selected]="true">{{batchId}}</option>
                <option *ngFor="let product of dataSubProductLists" value={{product}}>{{product}}</option>
              </select>
            </div>
          </div>
        </div>


        <div class="main-timeline">
          <div class="timeline {{certi.allign_classname}}" *ngFor="let certi of actDetail.certificates">
            <div *ngIf="certi != ''" (click)="onActivityDetails(certi)">
              <div class="">
                <div 
                  class="{{ certi.color_classname != ''? certi.color_classname : certi.classname}}">
                  <span class="timeline-icon"></span>
                  <div class="profile">
                    <div class="profile_left">
                      <h3>{{certi.company_name}}</h3>
                    </div>
                    <div class="profile_right" *ngIf="certi.company_logo && certi.company_logo !== 'None'">
                      <img src="{{certi.company_logo}}" class="cmpny-logo">
                    </div>
                  </div>
                  <div class="profile_right" *ngIf="certi.company_logo && certi.company_logo !== 'None'">
                    <img src="{{certi.company_logo}}" class="cmpny-logo">
                  </div>
                </div>
                <div class="timeline-content" *ngIf="!certi?.out_box_fields || certi?.out_box_fields?.length === 0">
                  <h3>{{'role' | translate}} : <br>
                    {{certi.certifier_designation !== 'None'? certi.certifier_designation : certi.role !== 'None' ? certi.role : ''}}
                  </h3>
                  <h3 *ngIf="certi.datetimeplace == 2 || certi.datetimeplace == 4">{{'date' | translate}}:</h3>
                  <p *ngIf="certi.datetimeplace == 2 || certi.datetimeplace == 4" class="date">{{certi.globaldatetime}}
                  </p>
                </div>
                <div class="timeline-content" *ngIf="certi?.out_box_fields?.length > 0">
                  <span *ngFor="let out_box_value of certi.out_box_fields">
                    <h3>
                      {{out_box_value.label + ' :'}}
                    </h3>
                    <p class="date" *ngIf="out_box_value.type !== 'document'">{{out_box_value.value}}</p>
                    <p class="date" *ngIf="out_box_value.type === 'document'"><a target="_blank"
                        href="{{out_box_value.value}}">click</a></p>
                  </span>
                  <h3 *ngIf="certi.datetimeplace == 2 || certi.datetimeplace == 4">{{'date' | translate}}:</h3>
                  <p *ngIf="certi.datetimeplace == 2 || certi.datetimeplace == 4" class="date">{{certi.globaldatetime}}
                  </p>
                </div>              
            </div>
          </div>
          </div>
        </div>
      </div>
      <div class="product-activity_popup">
        <ngx-smart-modal #myModal identifier="myModal" dismissable="false"
          (onAnyCloseEvent)="ngxSmartModalService.resetModalData('myModal')">
          <div class="badge-detail-separate" *ngIf="myModal.hasData()">

            <div class="product-detail-list">
              <div class="col-md-12 col-dm-12">
                <div class="product-title">
                  <h3>{{actDetail.title}}</h3>
                </div>
              </div>

              <div class="col-md-12 col-sm-12"
                *ngIf="myModal.getData().issuer_eth_address && myModal.getData().issuer_eth_address !== 'None' && myModal.getData().show_transaction">
                <div class="product_field">
                  <h4>{{'transaction_id' | translate}}:</h4>
                  <p>{{myModal.getData().issuer_eth_address || '&nbsp;'}}</p>
                </div>
              </div>

              <div class="col-md-6 col-sm-12"
                *ngIf="myModal.getData().evidence && myModal.getData().evidence !== 'None' && myModal.getData().show_transaction">
                <div class="product_field">
                  <h4>{{'evidence' | translate}}:</h4>
                  <a href="{{myModal.getData().evidence}}" target="_blank"> {{'view_evidence' | translate}} </a>
                </div>
              </div>

              <div *ngIf="myModal.getData().datetimeplace == 1 || myModal.getData().datetimeplace == 4"
                class="col-md-6 col-sm-12">
                <div class="product_field">
                  <h4>{{'created_on' | translate}}:</h4>
                  <p>{{myModal.getData().globaldatetime}}</p>
                </div>
              </div>

              <div class="row" *ngIf="myModal.getData().product_array.length > 0">
                <div class="col-md-12 col-sm-12">
                  <div class="product_details_title">
                    <h4>{{'product_information' | translate}}</h4>
                  </div>

                  <div class="col-md-12 col-sm-12" *ngFor="let productdata of myModal.getData().product_array">
                    <div class="product_details">
                      <ul class="product_list">
                        <li>
                          <img
                            [src]="productdata.image != '' ? productdata.image: 'assets/images/university-image.png'">
                        </li>
                        <li>
                          <p>{{productdata.title}}</p>
                          <p [innerHtml]="convertStyle(productdata.description)"></p>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-md-12 col-sm-12 content_center"
                *ngIf="myModal.getData().step_content && myModal.getData().step_content != '' &&  myModal.getData().step_content != 'None'">
                <h3>{{'description' | translate}}</h3>
                <p [innerHtml]="convertStyle(myModal.getData().step_content)"></p>
              </div>

              <div class="col-md-12 col-sm-12">
                <div class="product-title">
                  <h3>{{'activity' | translate}}</h3>
                </div>
              </div>

              <div class="col-md-6 col-sm-12"
                *ngIf="myModal.getData().in_batch_id && myModal.getData().in_batch_id != 'None' && myModal.getData().show_inoutbatch">
                <div class="product_field">
                  <h4>{{'batchid' | translate}}:</h4>
                  <p>{{myModal.getData().in_batch_id || '&nbsp;'}}</p>
                </div>
              </div>

              <div class="col-md-6 col-sm-12" *ngIf="myModal.getData().show_inoutbatch">
                <div class="product_field">
                  <h4>{{'subproductbatch' | translate}}:</h4>
                  <p>{{myModal.getData().out_batch_id || '&nbsp;'}}</p>
                </div>
              </div>

              <ng-container *ngFor="let displaycontent of myModal.getData().field_set">
                <div class="col-md-6 col-sm-12" *ngIf="displaycontent.in_box">
                  <div class="product_field">
                    <h4><b>{{displaycontent.label}}</b>:</h4>
                    <p
                      *ngIf="displaycontent.type !== 'document' && displaycontent.type !== 'date' && displaycontent.type !== 'timestamp'">
                      {{displaycontent.value || '&nbsp;'}}</p>

                    <p *ngIf="displaycontent.type === 'date'">
                      <span
                        *ngIf="displaycontent.dateformat == 1;else dmyy">{{displaycontent.value | date:'MM/dd/yyyy'}}</span>
                      <ng-template #dmyy>
                        <span>{{displaycontent.value | date:'dd/MM/yyyy'}}</span>
                      </ng-template>
                    </p>
                    <p *ngIf="displaycontent.type === 'timestamp'">
                      <span
                        *ngIf="displaycontent.dateformat == 1;else dmyytime">{{displaycontent.value != '' ? convertDateToStringMM(displaycontent.value) : ''}}</span>
                      <ng-template #dmyytime>
                        <span>{{displaycontent.value != '' ? convertDateToString(displaycontent.value) : ''}}</span>
                      </ng-template>
                    </p>
                    <p *ngIf="displaycontent.type === 'document'"><a
                        *ngIf="displaycontent.value && displaycontent.value != null && displaycontent.value !== ''"
                        target="_blank" href="{{displaycontent.value}}">{{'click' | translate}}</a></p>
                  </div>
                </div>
              </ng-container>

              <div class="col-md-6 col-sm-12"
                *ngIf="myModal.getData().activity_field_set.includes('country_certified') && myModal.getData().country_certified && myModal.getData().country_certified != 'None'">
                <div class="product_field">
                  <h4>{{'certified_country' | translate}}:</h4>
                  <p>{{myModal.getData().country_certified || '&nbsp;'}}</p>
                </div>
              </div>

              <div class="col-md-6 col-sm-12"
                *ngIf="myModal.getData().activity_field_set.includes('certifier_name') && myModal.getData().certifier_name && myModal.getData().certifier_name != 'None'">
                <div class="product_field">
                  <h4>{{'certifier_name' | translate}}:</h4>
                  <p>{{myModal.getData().certifier_name || '&nbsp;'}}</p>
                </div>
              </div>

              <div class="col-md-6 col-sm-12"
                *ngIf="myModal.getData().activity_field_set.includes('certifier_designation') && myModal.getData().certifier_designation && myModal.getData().certifier_designation != 'None'">
                <div class="product_field">
                  <h4>{{'certifier_designation' | translate}}:</h4>
                  <p>{{myModal.getData().certifier_designation || '&nbsp;'}}</p>
                </div>
              </div>

              <div class="col-md-6 col-sm-12"
                *ngIf="myModal.getData().activity_field_set.includes('certificate_number') && myModal.getData().certificate_number && myModal.getData().certificate_number != 'None'">
                <div class="product_field">
                  <h4>{{'certificate_number' | translate}}:</h4>
                  <p>{{myModal.getData().certificate_number || '&nbsp;'}}</p>
                </div>
              </div>

              <div class="col-md-6 col-sm-12"
                *ngIf="myModal.getData().activity_field_set.includes('date_issued') && myModal.getData().date_issued && myModal.getData().date_issued != 'None'">
                <div class="product_field">
                  <h4>{{'certified_date' | translate}}:</h4>
                  <p>{{myModal.getData().date_issued || '&nbsp;'}}</p>
                </div>
              </div>

              <div class="col-md-6 col-sm-12"
                *ngIf="myModal.getData().activity_field_set.includes('manufacture_date') && myModal.getData().manufacture_date && myModal.getData().manufacture_date != 'None'">
                <div class="product_field">
                  <h4>{{'manufacture_date' | translate}}:</h4>
                  <p>{{actDetail.manufacture_date || '&nbsp;'}}</p>
                </div>
              </div>

              <div
                *ngIf="myModal.getData().activity_field_set.includes('expire_date') && actDetail.expire_date && actDetail.expire_date !== 'None'"
                class="col-md-6 col-sm-12">
                <div class="product_field">
                  <h4>{{'expiry_date' | translate}}:</h4>
                  <p>{{actDetail.expire_date || '&nbsp;'}}</p>
                </div>
              </div>

              <div class="col-md-6 col-sm-12"
                *ngIf="myModal.getData().activity_field_set.includes('transport') && myModal.getData().transport && myModal.getData().transport != 'None'">
                <div class="product_field">
                  <h4>{{'transport' | translate}}:</h4>
                  <p>{{myModal.getData().transport || '&nbsp;'}}</p>
                </div>
              </div>

              <div class="col-md-6 col-sm-12"
                *ngIf="myModal.getData().activity_field_set.includes('shipping') && myModal.getData().shipping && myModal.getData().shipping != 'None'">
                <div class="product_field">
                  <h4>{{'shipping' | translate}}:</h4>
                  <p>{{myModal.getData().shipping || '&nbsp;'}}</p>
                </div>
              </div>

              <div class="col-md-6 col-sm-12"
                *ngIf="myModal.getData().activity_field_set.includes('category') && myModal.getData().category && myModal.getData().category != 'None'">
                <div class="product_field">
                  <h4>{{'category' | translate}}:</h4>
                  <p>{{myModal.getData().category || '&nbsp;'}}</p>
                </div>
              </div>

              <div class="col-md-6 col-sm-12"
                *ngIf="myModal.getData().activity_field_set.includes('weight') && myModal.getData().weight && myModal.getData().weight != 'None'">
                <div class="product_field">
                  <h4>{{'weight' | translate}}:</h4>
                  <p>{{myModal.getData().weight || '&nbsp;'}}</p>
                </div>
              </div>

              <div class="col-md-6 col-sm-12"
                *ngIf="myModal.getData().activity_field_set.includes('grade') && myModal.getData().grade && myModal.getData().grade != 'None'">
                <div class="product_field">
                  <h4>{{'grade' | translate}}:</h4>
                  <p>{{myModal.getData().grade || '&nbsp;'}}</p>
                </div>
              </div>

              <div class="col-md-6 col-sm-12"
                *ngIf="myModal.getData().activity_field_set.includes('packing_type') && myModal.getData().packing_type && myModal.getData().packing_type != 'None'">
                <div class="product_field">
                  <h4>{{'packing_type' | translate}}:</h4>
                  <p>{{myModal.getData().packing_type || '&nbsp;'}}</p>
                </div>
              </div>

              <div class="col-md-6 col-sm-12"
                *ngIf="myModal.getData().activity_field_set.includes('shell_life') && myModal.getData().shell_life && myModal.getData().shell_life != 'None'">
                <div class="product_field">
                  <h4>{{'minimum_shell_life' | translate}}:</h4>
                  <p>{{myModal.getData().shell_life || '&nbsp;'}}</p>
                </div>
              </div>

              <div class="col-md-6 col-sm-12"
                *ngIf="myModal.getData().activity_field_set.includes('storage_condition') && myModal.getData().storage_condition && myModal.getData().storage_condition != 'None'">
                <div class="product_field">
                  <h4>{{'storage_condition' | translate}}:</h4>
                  <p>{{myModal.getData().storage_condition || '&nbsp;'}}</p>
                </div>
              </div>

              <div class="col-md-6 col-sm-12"
                *ngIf="myModal.getData().activity_field_set.includes('processing_plant') && myModal.getData().processing_plant && myModal.getData().processing_plant != 'None'">
                <div class="product_field">
                  <h4>{{'processing_plant' | translate}}:</h4>
                  <p>{{myModal.getData().processing_plant || '&nbsp;'}}</p>
                </div>
              </div>

              <div
                *ngIf="myModal.getData().activity_field_set.includes('description') && myModal.getData().description && myModal.getData().description !== 'None'"
                class="col-md-12 col-sm-12">
                <div class="product_field">
                  <!-- <h4>{{'description' | translate}}:</h4> -->
                  <p [innerHtml]="convertStyle(myModal.getData().description)"></p>
                </div>
              </div>
            </div>
          </div>
        </ngx-smart-modal>
      </div>
    </div>
  </div>
</section>
