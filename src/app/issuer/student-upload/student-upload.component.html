<section class="start_wrapper bulk-upload">
  <div class="hpanel">
    <div class="panel-heading clearfix">
      <div class="pull-left">
        <h3>{{'bulk_upload' | translate}} <span matTooltip="{{'phi_stud_bulk_upload' | translate}}"
            class="headTooltip"><i class="material-icons"> help_outline</i></span></h3>
      </div>
      <div class="pull-right">
        <a class="export-btn" mat-mdc-button (click)="downloadSampleExcel()">{{'download_csv_template' | translate}}
          <span>
            <i class="fa fa-share-square-o"></i>
          </span>
        </a>
        <button mat-mdc-button routerLink="/students" class="upload-back-btn">
          <i class="fa fa-hand-o-left fa-1x" style="font-size:20px;"></i>
          {{'back_to_student_list' | translate}}</button>
      </div>
    </div>

    <mat-horizontal-stepper [linear]="true" #stepper>
      <mat-step [stepControl]="firstFormGroup">
        <form [formGroup]="firstFormGroup">
          <ng-template matStepLabel>{{'choose_file' | translate}}</ng-template>
          <div class="col-md-4 col-sm-12">
            <div class="file-upload-block">
              <mat-form-field>
                <input matInput formControlName="firstCtrl" readonly>
                <div class="upload-box">
                  <img src="assets/images/bulk-upload.png">
                </div>
                <button mat-mdc-button class="browse-file"
                  (click)="fileinput.click()">{{'browse_file' | translate}}</button>
                <input type="file" #fileinput accept=".csv" style="display: none;" (change)="upload($event)">
              </mat-form-field>
              <div>
                <button mat-mdc-button matStepperNext class="green">{{'next' | translate}}</button>
              </div>
            </div>
          </div>

          <div class="col-md-8 col-sm-12">
            <div class="uploader-progress-block">
              <div class="upload-progress">
                <img src="assets/images/folder.png">
              </div>
              <div role="tabpanel" class="upload-progress-bar tab-pane" id="skill">
                <div class="skill-section">
                  <div class="row">
                    <div class="col-md-8 col-md-offset-2 col-sm-8 col-sm-offset-2 col-xs-12">
                      <div class="filename-progress">
                      </div>
                      <div class="progress">
                        <div class="progress-bar  active" role="progressbar" aria-valuenow="45" aria-valuemin="0"
                          aria-valuemax="100" [ngStyle]="{width: percentDone + '%'}"></div>
                      </div>
                      <div class="text-left">{{percentDone}}% {{'done' | translate}}</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </form>
      </mat-step>

      <mat-step [stepControl]="secondFormGroup">
        <form [formGroup]="secondFormGroup">
          <ng-template matStepLabel>{{'upload_students' | translate}}</ng-template>

          <div class="step-secound">
            <button mat-mdc-button matStepperPrevious class="back" (click)="stepper.selectedIndex = 0;">{{'back' |
              translate}}</button>
            <button mat-mdc-button class="red"
              (click)="stepper.selectedIndex = 0;reset();">{{'clear_all' | translate}}</button>
            <button mat-mdc-button matStepperNext class="green" (click)="bulkCreate(stepper)">{{'next' |
              translate}}</button>
          </div>

          <div class="hpanel">
            <div class="panel-heading clearfix">
            </div>
            <div class="panel-body">
              <div class="table-responsive">
                <div class="example-container mat-elevation-z8">
                  <table mat-table #table [dataSource]="dataSource"
                    class="table table-striped table-bordered table-hover">
                    <!-- Name Column -->
                    <ng-container matColumnDef="Name">
                      <th style="width: 20%" mat-header-cell *matHeaderCellDef> {{'first_name' | translate}} </th>
                      <td mat-cell *matCellDef="let element"> {{element.first_name}} </td>
                    </ng-container>

                    <!-- Courses Column -->
                    <ng-container matColumnDef="Courses">
                      <th mat-header-cell *matHeaderCellDef> {{'last_name' | translate}} </th>
                      <td mat-cell *matCellDef="let element"> {{element.last_name}} </td>
                    </ng-container>

                    <!-- Certificate Column -->
                    <ng-container matColumnDef="Certificate">
                      <th mat-header-cell *matHeaderCellDef> {{'email' | translate}} </th>
                      <td mat-cell *matCellDef="let element"> {{element.email}} </td>
                    </ng-container>

                    <!-- Email Address Column -->
                    <ng-container matColumnDef="EmailAddress">
                      <th mat-header-cell *matHeaderCellDef> {{'phone' | translate}} </th>
                      <td mat-cell *matCellDef="let element"> {{element.phone || '-'}} </td>
                    </ng-container>

                    <!-- Actions Column -->
                    <ng-container matColumnDef="Action">
                      <th mat-header-cell *matHeaderCellDef> {{'actions' | translate}} </th>
                      <td mat-cell *matCellDef="let element" class="action_delt">
                        <a (click)="delete(element.email, stepper)">
                          <i class="fa fa-trash-o"></i>
                        </a>
                      </td>
                    </ng-container>
                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <div class="step-secound">
            <button mat-mdc-button matStepperPrevious class="back" (click)="stepper.selectedIndex = 0;">{{'back' |
              translate}}</button>
            <button mat-mdc-button class="red"
              (click)="stepper.selectedIndex = 0;reset();">{{'clear_all' | translate}}</button>
            <button mat-mdc-button matStepperNext class="green" (click)="bulkCreate(stepper)">{{'next' |
              translate}}</button>
          </div>
        </form>
      </mat-step>

      <mat-step [stepControl]="thirdFormGroup">
        <ng-template matStepLabel>{{'completed' | translate}}</ng-template>
        <div *ngIf="fail_count == 0" class="upload-success">
          <i class="fa fa-check-circle-o fa-lg"></i>
          <h3>{{'upload_successful' | translate}}</h3>
          <div class="">
            <button mat-mdc-button class="go-dash" routerLink="/students">{{'go_to_student_list' | translate}}</button>
            <button mat-mdc-button class="add-more"
              (click)="stepper.selectedIndex = 0;reset();">{{'add_more' | translate}}</button>
          </div>
        </div>
        <div *ngIf="fail_count != 0">
          <div class="student_count">
            <p>{{'no_of_student_not_added' | translate}} : {{fail_count}}</p>
          </div>

          <div class="failed-message">
            <i class="material-icons"> report_problem </i>
            <div class="report-list">
              <div *ngFor="let data of arrayOfKeys; let i = index">
                <div *ngIf="finalArrayCons[0][data].length > 0">
                  <h4>{{data | translate}}</h4>
                  <ul class="report-email">
                    <li *ngFor="let content of finalArrayCons[0][data]">
                      {{content.email}}
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          <div class="button-container">
            <button mat-mdc-button class="back go-dash" routerLink="/students">{{'go_to_student_list' | translate}}</button>
            <button mat-mdc-button class="back add-more" (click)="stepper.selectedIndex = 0;reset();">{{'add_more' |
              translate}}</button>
          </div>
        </div>
      </mat-step>
    </mat-horizontal-stepper>
    <mat-spinner *ngIf="process"></mat-spinner>
  </div>
</section>