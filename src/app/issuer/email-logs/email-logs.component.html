<section class="start_wrapper student-list">
  <div class="hpanel">
    <div class="panel-heading clearfix">
      <div class="pull-left">
        <h3>{{'email_logs' | translate}} <span matTooltip="{{'email_logs_info' | translate}}" class="headTooltip"><i
              class="material-icons"> help_outline</i></span></h3>
      </div>
    </div>

    <div class="panel-heading clearfix filter-search-box">
      <fieldset class="scheduler-border" *ngIf="!advanceSearch">
        <form [formGroup]="searchForm" (ngSubmit)="getStudents(searchForm.value)">
          <div class="col-lg-6 col-md-4 col-sm-12">
            <!-- <mat-form-field appearance="outline">
              <mat-label>{{'subject' | translate}}</mat-label>
              <input matInput class="form-control" formControlName="subject" name="search">
            </mat-form-field> -->

            <mat-form-field appearance="outline" class="autocomplete">
              <input formControlName="subject" [formControl]="subjectControl" autocomplete="off"
                (input)="getinputsubject($event.target.value)" placeholder="{{'subject' | translate}}" matInput
                [matAutocomplete]="auto_subject">
              <mat-autocomplete #auto_subject="matAutocomplete" (optionSelected)="subjectInput = $event.option.value">
                <mat-option *ngFor="let option of filtersubject | async" [value]="option.subject">
                  {{option.subject}}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
          </div>

          <div class="col-lg-6 col-md-8 col-sm-12">
            <div class="user-btn-block">
              <button type="submit" class="filter-btn search" mat-mdc-button>{{'search' | translate}}</button>
              <button type="submit" class="filter-btn search" mat-mdc-button
                (click)="advanceSearch = true">{{'advanced_search' | translate}}</button>
              <button type="reset" class="filter-btn reset" mat-mdc-button
                (click)="getStudents({'student_name':'', 'publisher_name':'', 'subject':''}, false, true)">{{'reset' |
                translate}}</button>
            </div>
          </div>
        </form>
      </fieldset>

      <fieldset class="scheduler-border" *ngIf="advanceSearch">
        <form [formGroup]="searchForm" (ngSubmit)="getStudents(searchForm.value)">

          <div class="col-lg-6 col-md-4 col-sm-12">
            <mat-form-field class="angular-datepicker field-datepicker">
              <input matInput placeholder="{{'from_date' | translate}}" [readonly]="true"
                (dateChange)="changeDateEvent($event, 'from_date')" [matDatepicker]="fromdate"
                formControlName="from_date" id="from_date" (click)="fromdate.open()">
              <mat-datepicker-toggle matSuffix [for]="fromdate"></mat-datepicker-toggle>
              <mat-datepicker #fromdate></mat-datepicker>
            </mat-form-field>
            <div class="refresh-icon" (click)="refreshFromDate()">
              <mat-icon>refresh</mat-icon>
            </div>
          </div>

          <div class="col-lg-6 col-md-4 col-sm-12">
            <mat-form-field class="angular-datepicker field-datepicker">
              <input matInput placeholder="{{'to_date' | translate}}" [matDatepicker]="todate" [readonly]="true"
                (dateChange)="changeDateEvent($event, 'to_date')" min={{minendDate}} formControlName="to_date"
                id="to_date" (click)="todate.open()">
              <mat-datepicker-toggle matSuffix [for]="todate"></mat-datepicker-toggle>
              <mat-datepicker #todate></mat-datepicker>
            </mat-form-field>
            <div class="refresh-icon" (click)="refreshToDate()">
              <mat-icon>refresh</mat-icon>
            </div>
          </div>

          <div class="col-lg-6 col-md-4 col-sm-12">
            <!-- <mat-form-field appearance="outline">
              <mat-label>{{'recipient_name' | translate}}</mat-label>
              <input matInput class="form-control" formControlName="student_name">
            </mat-form-field> -->

            <mat-form-field appearance="outline" class="autocomplete">
              <input formControlName="student_name" [formControl]="studentnameControl" autocomplete="off"
                (input)="getinputstudentname($event.target.value)" placeholder="{{'recipient_name' | translate}}"
                matInput [matAutocomplete]="auto_student_name">
              <mat-autocomplete #auto_student_name="matAutocomplete"
                (optionSelected)="studentnameInput = $event.option.value">
                <mat-option *ngFor="let option of filterstudentname | async" [value]="option.student_name">
                  {{option.student_name}}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
          </div>

          <div class="col-lg-6 col-md-4 col-sm-12">
            <!-- <mat-form-field appearance="outline">
              <mat-label>{{'publisher_name' | translate}}</mat-label>
              <input matInput class="form-control" formControlName="publisher_name">
            </mat-form-field> -->

            <mat-form-field appearance="outline" class="autocomplete">
              <input formControlName="publisher_name" [formControl]="publishernameControl" autocomplete="off"
                (input)="getinputpublishername($event.target.value)" placeholder="{{'publisher_name' | translate}}"
                matInput [matAutocomplete]="auto_publisher_name">
              <mat-autocomplete #auto_publisher_name="matAutocomplete"
                (optionSelected)="publishernameInput = $event.option.value">
                <mat-option *ngFor="let option of filterpublishername | async" [value]="option.publisher_name">
                  {{option.publisher_name}}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
          </div>

          <div class="col-lg-6 col-md-4 col-sm-12">
            <!-- <mat-form-field appearance="outline">
              <mat-label>{{'subject' | translate}}</mat-label>
              <input matInput class="form-control" formControlName="subject">
            </mat-form-field> -->

            <mat-form-field appearance="outline" class="autocomplete">
              <input formControlName="subject" [formControl]="subjectControl" autocomplete="off"
                (input)="getinputsubject($event.target.value)" placeholder="{{'subject' | translate}}" matInput
                [matAutocomplete]="auto_subject">
              <mat-autocomplete #auto_subject="matAutocomplete" (optionSelected)="subjectInput = $event.option.value">
                <mat-option *ngFor="let option of filtersubject | async" [value]="option.subject">
                  {{option.subject}}
                </mat-option>
              </mat-autocomplete>
            </mat-form-field>
          </div>

          <div class="col-lg-6 col-md-6 col-sm-12">
            <mat-form-field appearance="outline">
              <mat-label>{{'state' | translate}}</mat-label>
              <mat-select placeholder="Select" formControlName="state">
                <mat-option [value]="1">sent</mat-option>
                <mat-option [value]="2">failed</mat-option>
                <mat-option [value]="3">received</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <div class="col-lg-6 col-md-6 col-sm-12">
            <div class="user-btn-block">
              <button type="submit" class="filter-btn search" mat-mdc-button>{{'search' | translate}}</button>
              <button type="reset" class="filter-btn reset" mat-mdc-button
                (click)="getStudents({'student_name':'', 'publisher_name':'', 'subject':''}, false, true);resetForm()">{{'reset'
                | translate}}</button>
              <button type="reset" class="filter-btn reset" mat-button (click)="advanceSearch = false">{{'close' |
                translate}}</button>
            </div>
          </div>
        </form>
      </fieldset>
    </div>

    <div class="panel-body">
      <div class="table-responsive">
        <div class="example-container mat-elevation-z8">

          <table mat-table #table [dataSource]="dataSource" class="table table-striped table-bordered table-hover"
            *ngIf="!process">

            <ng-container matColumnDef="date">
              <th mat-header-cell *matHeaderCellDef> {{'date' | translate}} </th>
              <td mat-cell *matCellDef="let element"> {{element.created | date}} </td>
            </ng-container>

            <!-- Certificate Number Column -->
            <ng-container matColumnDef="student_name">
              <th mat-header-cell *matHeaderCellDef> {{'recipient_name' | translate}} </th>
              <td mat-cell *matCellDef="let element"> {{element.student_name}} </td>
            </ng-container>

            <!-- Issue Date Column -->
            <ng-container matColumnDef="publisher_name">
              <th mat-header-cell *matHeaderCellDef> {{'publisher_name' | translate}}</th>
              <td mat-cell *matCellDef="let element"> {{element.publisher_name || '-'}} </td>
            </ng-container>

            <ng-container matColumnDef="subject">
              <th mat-header-cell *matHeaderCellDef> {{'subject' | translate}} </th>
              <td mat-cell *matCellDef="let element"> {{element.subject || '-'}} </td>
            </ng-container>

            <ng-container matColumnDef="state">
              <th mat-header-cell *matHeaderCellDef> {{'status' | translate}} </th>
              <td mat-cell *matCellDef="let element"> {{element.status || '-'}} </td>
            </ng-container>
            <!-- Evidence Number Column -->
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef> {{'actions' | translate}} </th>
              <td mat-cell *matCellDef="let element" class="edt_delt">
                <button *ngIf="element.status !== 'rejected'" mat-button class="green"
                  (click)="setCertId(element.id);ngxSmartModalService.getModal('myModal').open();">{{'view' |
                  translate}}
                </button>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>

          <mat-spinner *ngIf="process"></mat-spinner>
          <div class="col-sm-12" *ngIf="!process">
            <div class="alert alert-info no-records" *ngIf="studentList.length === 0">
              {{'no_records_found' | translate}}
            </div>
          </div>
          <mat-paginator [length]="studentList.count" [hidePageSize]="true" [pageSize]="5"
            [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons (page)="onPageChange(searchForm.value,$event)">
          </mat-paginator>
        </div>
      </div>
    </div>
  </div>
  <ngx-smart-modal #myModal identifier="myModal" (onAnyCloseEvent)="ngxSmartModalService.resetModalData('myModal')"
    class="mail_details">
    <div>

      <div class="mail-content-class">
        <fieldset>
          <legend>{{'mail_detail' | translate}}</legend>
          <div class="spinner-center">
            <mat-spinner *ngIf="loaderMailcontent"></mat-spinner>
          </div>
          <div *ngIf="!loaderMailcontent && resMandrilData.status != 'error'" class="password-enter delete-container">
            <h5><span class="email-title">{{'recipient_name' | translate}} </span> {{resMandrilData.student_name}}</h5>
            <h5><span class="email-title">{{'stud_email' | translate}} </span> {{resMandrilData.email}}</h5>
            <h5><span class="email-title">{{'publisher_name' | translate}} </span> {{resMandrilData.publisher_name}}
            </h5>
            <h5><span class="email-title">{{'subject' | translate}} </span> {{resMandrilData.subject}}</h5>
            <h5><span class="email-title">{{'message' | translate}}</span></h5>
            <div class="dynamic-content" *ngIf="resMandrilData.message;else textContent;"
              [innerHTML]="resMandrilData.message"></div>
            <ng-template #textContent>
              <div class="mandrilldate">
                <p>{{resMandrilData.text}}</p>
              </div>
            </ng-template>
            <br>
            <div class="failed_reason" *ngIf="resMandrilData?.failed_reason && resMandrilData?.failed_reason != ''">
              <h5><span class="email-title">{{'failed_reason' | translate}}</span></h5>
              <div class="dynamic-content" [innerHTML]="resMandrilData?.failed_reason"></div>
            </div>
          </div>
          <div *ngIf="!loaderMailcontent && resMandrilData.status === 'error'">
            <div>Mail service : {{'some_error_occurred' | translate}}</div>
          </div>
        </fieldset>
      </div>
    </div>
  </ngx-smart-modal>

</section>